// app.js
var routerApp = angular.module('naplanta', ['ui.router', 'ui.bootstrap', 'angularFileUpload']);

routerApp.config(function($stateProvider, $urlRouterProvider, $locationProvider) {
    
    $urlRouterProvider.otherwise('/home');
    
    $stateProvider
        
        // HOME STATES AND NESTED VIEWS ========================================
        .state('home', {
            url: '/home',
            templateUrl: 'home.html',
            controller: function($scope, $stateParams, $state) {
 		
 		/**if (!Parse.User.current()) {
            		$state.go('login');
            	}**/
          }
        })
        
        .state('empreendimentos', {
            url: '/empreendimentos',
            templateUrl: 'emps.html',
            controller: function($scope, $stateParams, $state) {
            
                //***********
                var Emp= Parse.Object.extend("empreendimento");
                var query = new Parse.Query(Emp);
                //query.equalTo("publico", true);
                query.find({
                    success: function(results) {

                        var dados = '';
                        for (var i = 0; i < results.length; i++) { 
                              var object = results[i];
                              /*dados = dados += '<li><a href="#/emp/'+object.id+'">'+object.get('nome')+'</a></li>';*/
                              dados += '<div class="col-sm-6 col-md-4">';
                                dados += '<div class="thumbnail">';
                                dados += '<a href="#/emp/'+object.id+'"><img src="'+object.get('capa')+'" alt="'+object.get('nome')+'"></a>';
                                dados += '<div class="caption">';
                                dados += '<h3>'+object.get('nome')+'</h3>';
                                dados += '<p>'+object.get('construtora')+'</p>';
                                dados += '<p><a href="#/emp/'+object.id+'" class="btn btn-primary" role="button">Serviços</a> <a href="#/emp/'+object.id+'" class="btn btn-default" role="button">Detalhes</a></p>';
                                dados += '</div>';
                                dados += '</div>';
                                dados += '</div>';
                            }

                         $('#listemp').html(dados);


                    },
                    error: function(error) {
                            alert("Error: " + error.code + " " + error.message);
                    }
                });
		
                // $state.go('grupo.detail', { grupoId: $scope.id });
            }
        })
        
        .state('emp', {
            url: '/emp/:empID',
            templateUrl: 'emp.html',
            controller: function($scope, $stateParams, $state) {
            
            	/*if (!Parse.User.current()) {
            		$state.go('login');
            	}*/
            
                //$scope.id = $stateParams.grupoID;
                $scope.empid = $stateParams.empID;
                
                var empid = $stateParams.empID; 
                
                /*Parse.Cloud.run('getEmpreendimento', {emp: empid}, {
  success: function(result) {
    // result is 'Hello world!'
      console.log('retorno cloud code');
      console.log(result);
  },
  error: function(error) {
      console.log(error);
  }
});*/
                
                //***********
                var ret;
                
                var qtdservreal;
                var qtdservsug;
    
                var Emp= Parse.Object.extend("empreendimento");
                var query = new Parse.Query(Emp);
                query.equalTo("objectId", empid);
                
                query.find({
                    success: function(results) {
                    console.log(results);
                        var linkimage = 'http://naplanta.imagefly.io/w_800,h_300,f_png/'+results[0].attributes.capa;
                
                        /*ret = '<h2>'+results[0].attributes.nome+'</h2>';
                        ret += '<p><i class="glyphicons glyphicons-riflescope"></i> <a href="#">'+results[0].attributes.construtora+'</p><br>';
                        ret += '<p>'+results[0].attributes.endereco+'</p><br>';

                        $('#dadosemp').html(ret);
                        $('#imgcapa').html('<div class="fullWidth"><img src="http://naplanta.imagefly.io/w_800,h_300,f_png/'+results[0].attributes.capa+'" alt="header-picture"></div>');
                        $('#logo').html('<img src="'+results[0].attributes.logo+'" class="img-thumbnail">');*/
                        
                        ret = '<div class="row container-fluid profile-header" style="background: -moz-linear-gradient(top, rgba(0,0,0,0) 0%, rgba(0,0,0,0) 59%, rgba(0,0,0,1) 100%), url('+linkimage+') no-repeat center center;-webkit-background-size: cover;';
                        ret += 'background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(0,0,0,0)), color-stop(59%,rgba(0,0,0,0)), color-stop(100%,rgba(0,0,0,1))), url('+linkimage+') no-repeat center center;-webkit-background-size: cover;';
                        ret += 'background: -webkit-linear-gradient(top, rgba(0,0,0,0) 0%,rgba(0,0,0,0) 59%,rgba(0,0,0,1) 100%), url('+linkimage+') no-repeat center center;-webkit-background-size: cover;';
                        ret += 'background: -o-linear-gradient(top, rgba(0,0,0,0) 0%,rgba(0,0,0,0) 59%,rgba(0,0,0,1) 100%), url('+linkimage+') no-repeat center center;-webkit-background-size: cover;';
                        ret += 'background: -ms-linear-gradient(top, rgba(0,0,0,0) 0%,rgba(0,0,0,0) 59%,rgba(0,0,0,1) 100%), url('+linkimage+') no-repeat center center;-webkit-background-size: cover;';
                        ret += 'background: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0) 59%,rgba(0,0,0,1) 100%), url('+linkimage+') no-repeat center center;-webkit-background-size: cover;';
	ret += '-moz-background-size: cover;';
	ret += '-o-background-size: cover;';
	ret += 'background-size: cover;';
    ret += 'padding-top:150px;';
	ret += 'padding-bottom:20px;';
	ret += 'vertical-align: bottom;">';
	ret += '<div class="container">';
	ret += '	<div class="row profile-header-content">';
	ret += '		<div class="col-md-3 col-sm-3 col-xs-4 profile-pic"><img src="'+results[0].attributes.logo+'" class="img-thumbnail"></div>';
	ret += '		<div class="col-md-9 col-sm-9 col-xs-8 profile-about">';
    ret += '            <h2>'+results[0].attributes.nome+'</h2>';
    ret += '            <p><i class="glyphicons glyphicons-riflescope"></i> <a href="#">'+results[0].attributes.construtora+'</a></p>';
    /*ret += '            <p>'+results[0].attributes.endereco+'</p><br>';*/
    ret += '        </div>';
    ret += '    </div>';
	ret += '</div>';
ret += '</div>';
                        ret += '<div class="row"  style="padding-top: 40px;">';
                        ret += '   <div class="col-sm-2">';
                        
                        ret += '      <ul class="list-group">';
                        
                        ret += '        <li class="list-group-item text-muted">Dados</li>';
                        ret += '        <li class="list-group-item text-right"><span class="pull-left"><strong class="">Tipo</strong></span>'+results[0].attributes.tipo+'</li>';
                        ret += '        <li class="list-group-item text-right"><span class="pull-left"><strong class="">Unidades</strong></span>'+results[0].attributes.unidades+'</li>';
                        ret += '        <li class="list-group-item text-right"><span class="pull-left"><strong class="">Status</strong></span>';
                        if (results[0].attributes.pronto == true) {
                            ret += '<span class="label label-success">Pronto</span></li>'; 
                        } else {
                            ret += '<span class="label label-info">Em obras</span></li>'; 
                        };
                        ret += '      </ul>';
                        
                        ret += '      <ul class="list-group">';
                        ret += '        <li class="list-group-item text-muted">Serviços</li>';
                        ret += '        <li class="list-group-item text-right"><span class="pull-left"><strong class="">Realizados</strong></span> <span id="qtdservreal">0</span></li>';
                        ret += '        <li class="list-group-item text-right"><span class="pull-left"><strong class="">Sugeridos</strong></span> <span id="qtdservsuge">0</span></li>';
                        ret += '      </ul>';
                        
                        ret += '      <ul class="list-group">';
                        ret += '        <li class="list-group-item text-muted">Ações</li>';
                        ret += '        <li class="list-group-item text-right"><button type="button" class="btn btn-danger">Action</button></li>';
                        ret += '        <li class="list-group-item text-right"><button type="button" class="btn btn-danger">Action</button></li>';
                        ret += '      </ul>';
                        
                        ret += '      <div class="panel panel-default">';
                        ret += '            <div class="panel-heading">Cadastrado por</div>';
                        ret += '            <div class="panel-body"><span id="cadporimg"></span><span id="cadpor"></span></div>';
                        ret += '       </div>';
                        
                        ret += '       <div class="panel panel-default">';
                        ret += '            <div class="panel-heading">Website <i class="fa fa-link fa-1x"></i></div>';
                        ret += '       <div class="panel-body"><a href="'+results[0].attributes.url+'" class="">Acessar o site</a></div></div>';
                        
                        ret += '       <div class="panel panel-default">';
                        ret += '            <div class="panel-heading">Social</div>';
                        ret += '            <div class="panel-body">	<i class="fa fa-facebook fa-2x"></i>  <i class="fa fa-github fa-2x"></i> ';
                        ret += '                <i class="fa fa-twitter fa-2x"></i> <i class="fa fa-pinterest fa-2x"></i>  <i class="fa fa-google-plus fa-2x"></i>';
                        ret += '            </div>';
                        ret += '       </div>';
                        ret += '    </div>';
                        
                        ret += '    <div class="col-sm-10" style="">';
                        ret += '        <div class="panel panel-default">';
                        ret += '            <div class="panel-heading" contenteditable="false">Endereço</div>';
                        ret += '            <div class="panel-body" contenteditable="false"><h2>'+results[0].attributes.endereco+'</h2></div>';
                        ret += '        </div>';
                        ret += '        <div id="listsugserv">';
                        ret += '            <div class="spinner">';
                        ret += '                <div class="double-bounce1"></div>';
                        ret += '                <div class="double-bounce2"></div>';
                        ret += '            </div>';
                        ret += '        </div>';
                        ret += '        <div id="listrealserv">';
                        ret += '            <div class="spinner">';
                        ret += '                <div class="double-bounce1"></div>';
                        ret += '                <div class="double-bounce2"></div>';
                        ret += '            </div>';
                        ret += '        </div>';
                        ret += '    </div>';
                        ret += '</div>';
                        
                        $('#profile').html(ret);
                        //$('#teste').html(getNegocioporEmp());
                        
                        
                        //****** cadastrado por
                        var cadastropor = results[0].attributes.cadastropor;
                        //console.log('cadastropor '+cadastropor);
                        //console.log('current/ '+Parse.User.current().id);
                        
                        //**********
                        var uquery = new Parse.Query(Parse.User);
			             uquery.get(cadastropor, {
			                 
                         	success: function(object) {
			                     var fbid = '/'+object.attributes.facebookid;
                                //var fbid = '/10205961738269756';
                                
                                if (Parse.User.current().id == cadastropor){
                                    fbid = '/me';
                                }
                                
                                console.log('fbid '+fbid);
                                 
                                 FB.api(
                                        fbid,
                                        function (response) {
                                            if (response) {
                                                /* handle the result */
                                                //console.log('fb api response');
                                                //console.log(response);
                                                $('#cadpor').html(response.name);
                                            }
                                        }
                                 );
			     	
			                 FB.api(fbid+'/picture',
                                    {
                                        "redirect": false,
                                        "height": "50",
                                        "type": "normal",
                                        "width": "50"
                                    },
                                    function (response) {
                                      if (response) {
                                          $('#cadporimg').html('<img width="30" heigth="30" src="'+response.data.url+'">');
                                        //$('#imgAnunciante').html('<img src="'+response.data.url+'">');
                                          //console.log('response img fb ');
                                            //console.log(response);
                                      }
                                    }
                                );
                                
			                 },
			
			                 error: function(object, error) {
			                     // error is an instance of Parse.Error.
                                 console.log(error);
			                 }
			             });
                        
                        //**** cadastrado por
                        
                        //**** get plantas
                        /*var Plantas= Parse.Object.extend("planta");
                        var query = new Parse.Query(Plantas);
                        query.equalTo("empreendimento", empid);
                        
                        query.find({
                            success: function(results) {
                
                                var dados = '';
                                for (var i = 0; i < results.length; i++) { 
                                    var object = results[i];
                                    dados = dados + '<li><a href="#">'+object.get('desc')+'</a></li>';
                                }

                                $('#listplantas').html(dados);
                            },
                            error: function(error) {
                                alert("Error: " + error.code + " " + error.message);
                            }
                        })*/
                        //**** fim plantas
                        
                        //**** get serviços sugeridos
                        var ServicoEmp= Parse.Object.extend("servico_emp");
                        var Servicos = Parse.Object.extend("servico");
                        var Fornec = Parse.Object.extend("fornecedor");
                        var innerQuery = new Parse.Query(ServicoEmp);
                        var fornQuery = new Parse.Query(Fornec);
                        innerQuery.equalTo("emp", empid);
                        
                        /*innerQuery.find({
                            success: function(results) {
                
                                $('#qtdservsuge').html(results.length);
                            },
                            error: function(error) {
                                alert("Error: " + error.code + " " + error.message);
                            }
                        })*/
                        
                        
                        var query = new Parse.Query(Servicos);
                        query.matchesKeyInQuery('objectId', 'servico', innerQuery);
                        
                        query.count({
                            success: function(count) {
                                qtdservsug = count;
                            },
                            error: function(error) {
                                // The request failed
                                qtdservsug = 0;
                            }
                        });
                        query.limit(4);
                        
                        query.find({
                            success: function(results) {
                                
                                //$('#qtdservsuge').html(results.length);
                                //console.log('qtdservsug '+qtdservsug);
                
                                console.log('serviços sugeridos ');
                                console.log(results);
                                //$('#listplantas').html(dados);
                                var dados = '';
                                
                                dados += '<div class="panel panel-default target">';
                                dados += '   <div class="panel-heading">Serviços Sugeridos   <a href="#/emp/'+empid+'/servicos/sugeridos" class="btn btn-default btn-sm" style="float: right;" role="button">Veja todos</a></div>';
                                dados += '  <div class="panel-body">';
                                dados += '      <div class="row">';
                                
                                for (var i = 0; i < results.length; i++) { 
                                    var object = results[i];
                                    /*dados += '<div><div><span>'+object.get('desc')+'</span><br><span>'+object.get('preco')+'</span><br><span id="fornec'+object.get('fornec')+'"></span></div>';*/
                                    
                                dados += '<div class="col-sm-6 col-md-3">';
                                dados += '<div class="thumbnail">';
                                dados += '<a href="#/servico/'+object.id+'" ><img src="'+object.get('capa')+'" alt=""></a>';
                                dados += '<div class="caption">';
                                dados += '<h3>'+object.get('desc')+'</h3>';
                                dados += '<p  class="label label-success">A partir de R$ '+object.get('preco')+'</p>';
                                dados += '<p id="fornec'+object.get('fornec')+'"></p>';
                                dados += '<p><a href="#/servico/'+object.id+'" class="btn btn-default" role="button">Detalhes</a></p>';
                                dados += '</div>';
                                dados += '</div>';
                                dados += '</div>';
                                
                                }
                                
                                dados += '         </div>';
                                dados += '      </div>';
                                dados += '  </div>';
                                
                                $('#listsugserv').html(dados);
                            },
                            error: function(error) {
                                alert("Error: " + error.code + " " + error.message);
                            }
                        })
                        
                        fornQuery.find({
                            success: function(results) {
                                            
                                for (var i = 0; i < results.length; i++) { 
                                    var fornec = results[i];
                                    console.log('fornecedor ');
                                            console.log(fornec);
                                            //dados += '<div><span>'+fornec.get('nome')+'</span></div>';
                                            //alert(results[i].id);
                                            $('#fornec'+results[i].id).html(results[i].attributes.nome);
                                    
                                }
                            },
                            error: function(error) {
                                alert("Error: " + error.code + " " + error.message);
                            }
                        })
                        //**** fim serviços sugeridos
                        //**** get serviços realizados
                        var Negocio= Parse.Object.extend("negocio");
                        var Servicos = Parse.Object.extend("servico");
                        var innerQuery = new Parse.Query(Negocio);
                        innerQuery.equalTo("emp", empid);
                        innerQuery.find({
                            success: function(results) {
                
                                //console.log(results);
                                //$('#listrealserv').html(dados);
                                
                                var query = new Parse.Query(Servicos);
                                query.matchesKeyInQuery('objectId', 'servico', innerQuery);  
                        
                                query.find({
                                    success: function(results) {
                
                                        console.log('serviços realizados ');
                                        console.log(results);
                                        var dados = '';
                                        
                                    qtdservreal = results.length;
                                
                                dados += '<div class="panel panel-default target">';
                                dados += '   <div class="panel-heading">Serviços Realizados   <a href="#/emp/'+empid+'/servicos/realizados" class="btn btn-default btn-sm" style="float: right;" role="button">Veja todos</a></div>';
                                dados += '  <div class="panel-body">';
                                dados += '      <div class="row">';
                                
                                for (var i = 0; i < results.length; i++) { 
                                    var object = results[i];
                                    /*dados += '<div><div><span>'+object.get('desc')+'</span><br><span>'+object.get('preco')+'</span><br><span id="fornec'+object.get('fornec')+'"></span></div>';*/
                                    
                                    dados += '<div class="col-sm-6 col-md-3">';
                                dados += '<div class="thumbnail">';
                                dados += '<a href="#/servico/'+object.id+'" ><img src="'+object.get('capa')+'" alt=""></a>';
                                dados += '<div class="caption">';
                                dados += '<h3>'+object.get('desc')+'</h3>';
                                dados += '<p  class="label label-success">A partir de R$ '+object.get('preco')+'</p>';
                                dados += '<p id="fornec'+object.get('fornec')+'"></p>';
                                dados += '<p><a href="#/servico/'+object.id+'" class="btn btn-default" role="button">Detalhes</a></p>';
                                dados += '</div>';
                                dados += '</div>';
                                dados += '</div>';
                                
                                }
                                
                                dados += '         </div>';
                                dados += '      </div>';
                                dados += '  </div>';
                                
                                $('#listrealserv').html(dados);
                                        
                                $('#qtdservreal').html(qtdservreal);
                                $('#qtdservsuge').html(qtdservsug);
                                        
                                    },
                                    error: function(error) {
                                        alert("Error: " + error.code + " " + error.message);
                                    }
                                })
                            },
                            error: function(error) {
                                alert("Error: " + error.code + " " + error.message);
                            }
                        })
                        
                        //**** fim serviços realizados
                    },
                    error: function(error) {
                        alert("Error: " + error.code + " " + error.message);
                    }
                });
                //***********

               // $state.go('grupo.detail', { grupoId: $scope.id });
 
            }
        })
        
        .state('empservicosrealizados', {
            url: '/emp/:empID/servicos/realizados',
            templateUrl: 'servicos.html',
            controller: function($scope, $stateParams, $state) {
            
                $scope.empid = $stateParams.empID;
                var empid = $stateParams.empID; 
                
                var Emp= Parse.Object.extend("empreendimento");
                var query = new Parse.Query(Emp);
                query.equalTo("objectId", empid);
                
                query.find({
                    success: function(results) {
                    
                    var empreendimento = results[0];
                    
                    var linkimage = 'http://naplanta.imagefly.io/w_600,h_100,f_png/'+results[0].attributes.capa;
                
                        /*ret = '<h2>'+results[0].attributes.nome+'</h2>';
                        ret += '<p><i class="glyphicons glyphicons-riflescope"></i> <a href="#">'+results[0].attributes.construtora+'</p><br>';
                        ret += '<p>'+results[0].attributes.endereco+'</p><br>';

                        $('#dadosemp').html(ret);
                        $('#imgcapa').html('<div class="fullWidth"><img src="http://naplanta.imagefly.io/w_800,h_300,f_png/'+results[0].attributes.capa+'" alt="header-picture"></div>');
                        $('#logo').html('<img src="'+results[0].attributes.logo+'" class="img-thumbnail">');*/
                        
                        ret = '<div class="container-fluid profile-header" style="background: -moz-linear-gradient(top, rgba(0,0,0,0) 0%, rgba(0,0,0,0) 59%, rgba(0,0,0,1) 100%), url('+linkimage+') no-repeat center center;-webkit-background-size: cover;';
                        ret += 'background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(0,0,0,0)), color-stop(59%,rgba(0,0,0,0)), color-stop(100%,rgba(0,0,0,1))), url('+linkimage+') no-repeat center center;-webkit-background-size: cover;';
                        ret += 'background: -webkit-linear-gradient(top, rgba(0,0,0,0) 0%,rgba(0,0,0,0) 59%,rgba(0,0,0,1) 100%), url('+linkimage+') no-repeat center center;-webkit-background-size: cover;';
                        ret += 'background: -o-linear-gradient(top, rgba(0,0,0,0) 0%,rgba(0,0,0,0) 59%,rgba(0,0,0,1) 100%), url('+linkimage+') no-repeat center center;-webkit-background-size: cover;';
                        ret += 'background: -ms-linear-gradient(top, rgba(0,0,0,0) 0%,rgba(0,0,0,0) 59%,rgba(0,0,0,1) 100%), url('+linkimage+') no-repeat center center;-webkit-background-size: cover;';
                        ret += 'background: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0) 59%,rgba(0,0,0,1) 100%), url('+linkimage+') no-repeat center center;-webkit-background-size: cover;';
	ret += '-moz-background-size: cover;';
	ret += '-o-background-size: cover;';
	ret += 'background-size: cover;';
    ret += 'padding-top:10px;';
	ret += 'padding-bottom:10px;';
	ret += 'vertical-align: bottom;">';
	ret += '<div class="container">';
	ret += '	<div class="row profile-header-content">';
	ret += '		<div class="col-md-3 col-sm-3 col-xs-4 profile-pic"><img src="'+results[0].attributes.logo+'" class="img-thumbnail"></div>';
	ret += '		<div class="col-md-9 col-sm-9 col-xs-8 profile-about">';
    ret += '            <h2>'+results[0].attributes.nome+'</h2>';
    ret += '            <p><i class="glyphicons glyphicons-riflescope"></i> <a href="#">'+results[0].attributes.construtora+'</a></p>';
    /*ret += '            <p>'+results[0].attributes.endereco+'</p><br>';*/
    ret += '        </div>';
    ret += '    </div>';
	ret += '</div>';
ret += '</div>';
                
                //**** get serviços realizados
                        var Negocio= Parse.Object.extend("negocio");
                        var Servicos = Parse.Object.extend("servico");
                        var innerQuery = new Parse.Query(Negocio);
                        innerQuery.equalTo("emp", empid);
                        innerQuery.find({
                            success: function(results) {
                
                                //console.log(results);
                                //$('#listrealserv').html(dados);
                                
                                var query = new Parse.Query(Servicos);
                                query.matchesKeyInQuery('objectId', 'servico', innerQuery);  
                        
                                query.find({
                                    success: function(results) {
                
                                        //console.log('serviços realizados ');
                                        //console.log(results);
                                        var dados = '';
                                
                                dados += '<div class="panel panel-default">';
                                dados += '  <div class="panel-heading">';
                                dados += '      <h3 class="panel-title">'+empreendimento.get('nome')+'Serviços Realizados</h3>';
                                dados += '  </div>';
                                dados += '  <div class="panel-body">';
                                dados += '      <div class="row">';
                                
                                for (var i = 0; i < results.length; i++) { 
                                    var object = results[i];
                                    /*dados += '<div><div><span>'+object.get('desc')+'</span><br><span>'+object.get('preco')+'</span><br><span id="fornec'+object.get('fornec')+'"></span></div>';*/
                                    
                                    dados += '<div class="col-sm-6 col-md-4">';
                                dados += '<div class="thumbnail">';
                                dados += '<img src="'+object.get('capa')+'" alt="">';
                                dados += '<div class="caption">';
                                dados += '<h3>'+object.get('desc')+'</h3>';
                                dados += '<p>'+object.get('preco')+'</p>';
                                dados += '<p id="fornec'+object.get('fornec')+'"></p>';
                                dados += '<p><a href="#/servico/'+object.id+'" class="btn btn-default" role="button">Detalhes</a></p>';
                                dados += '</div>';
                                dados += '</div>';
                                dados += '</div>';
                                
                                }
                                
                                dados += '         </div>';
                                dados += '      </div>';
                                dados += '  </div>';
                                        $('#listservicos').html(ret + dados);
                                    },
                                    error: function(error) {
                                        alert("Error: " + error.code + " " + error.message);
                                    }
                                })
                            },
                            error: function(error) {
                                alert("Error: " + error.code + " " + error.message);
                            }
                        })
                        
                        //**** fim serviços realizados
                    },
                            error: function(error) {
                                alert("Error: " + error.code + " " + error.message);
                            }
                })
            	
            }
        })
    
        .state('emp.comodos', {
            url: '/emp/:empID/comodo/:comodoID',
            templateUrl: 'emp.comodo.html',
            controller: function($scope, $stateParams, $state) {
                
                var Emp= Parse.Object.extend("empreendimento");
                var query = new Parse.Query(Emp);
                //query.equalTo("publico", true);
                query.find({
                    success: function(results) {

                        var dados = '';
                        for (var i = 0; i < results.length; i++) { 
                              var object = results[i];
                              dados = dados + '<li><a href="#/emp/'+object.id+'">'+object.get('nome')+'</a></li>';
                            }

                         $('#listcomodos').html(dados);


                    },
                    error: function(error) {
                            alert("Error: " + error.code + " " + error.message);
                    }
                });
            	
            }
        })
    
        .state('prestadores', {
            url: '/prestadores',
            templateUrl: 'prests.html',
            controller: function($scope, $stateParams, $state) {
            
                //***********
                var Prest= Parse.Object.extend("fornecedor");
                var query = new Parse.Query(Prest);
                //query.equalTo("publico", true);
                query.find({
                    success: function(results) {

                            var dados = '';
                        for (var i = 0; i < results.length; i++) { 
                              var object = results[i];
                              /*dados = dados + '<li><a href="#/prest/'+object.id+'">'+object.get('nome')+'</a></li>';*/
                              dados += '<div class="col-sm-6 col-md-4">';
                                dados += '<div class="thumbnail">';
                                dados += '<img src="'+object.get('capa')+'" alt="'+object.get('nome')+'">';
                                dados += '<div class="caption">';
                                dados += '<h3>'+object.get('nome')+'</h3>';
                                dados += '<p>'+object.get('servicos')+'</p>';
                                dados += '<p><a href="#/prest/'+object.id+'" class="btn btn-primary" role="button">Serviços</a> <a href="#/prest/'+object.id+'" class="btn btn-default" role="button">Detalhes</a></p>';
                                dados += '</div>';
                                dados += '</div>';
                                dados += '</div>';
                            }

                         $('#listprest').html(dados);


                    },
                    error: function(error) {
                            alert("Error: " + error.code + " " + error.message);
                    }
                });
		
                // $state.go('grupo.detail', { grupoId: $scope.id });
            }
        })
    
        .state('prestador', {
            url: '/prest/:prestID',
            templateUrl: 'prest.html',
            controller: function($scope, $stateParams, $state) {
            
            	/*if (!Parse.User.current()) {
            		$state.go('login');
            	}*/
            
                //$scope.id = $stateParams.grupoID;
                $scope.prestid = $stateParams.prestID;
                
                var prestid = $stateParams.prestID;
            
                //console.log('feira  '+$scope.feiraid);
                
                //***********
                var ret;
    
                var Prest= Parse.Object.extend("fornecedor");
                var query = new Parse.Query(Prest);
                query.equalTo("objectId", prestid);
                
                query.find({
                    success: function(results) {
                
                        ret = '<h3>'+results[0].attributes.nome+'</h3>';
                        ret += '<p>'+results[0].attributes.responsavel+'</p><br>';
                        ret += '<p>'+results[0].attributes.endereco+'</p><br>';

                        $('#dadosprest').html(ret);
                    },
                    error: function(error) {
                        alert("Error: " + error.code + " " + error.message);
                    }
                });
                //***********

               // $state.go('grupo.detail', { grupoId: $scope.id });
 
            }
        })
        
        .state('servicos', {
            url: '/servicos',
            templateUrl: 'servicos.html',
            controller: function($scope, $stateParams, $state) {
                var ret;
    
                var Servico= Parse.Object.extend("servico");
                var query = new Parse.Query(Servico);
                
                query.find({
                    success: function(results) {

                        var dados = '';
                        for (var i = 0; i < results.length; i++) { 
                              var object = results[i];
                              dados += '<div class="col-sm-6 col-md-4">';
                                dados += '<div class="thumbnail">';
                                dados += '<img src="'+object.get('capa')+'" alt="'+object.get('nome')+'">';
                                dados += '<div class="caption">';
                                dados += '<h3>'+object.get('desc')+'</h3>';
                                dados += '<p>'+object.get('resumo').substring(0, 300) +'...</p>';
                                dados += '<p  class="label label-success">A partir de R$ '+object.get('preco')+'</p>';
                                dados += '<p><a href="#/prest/'+object.get('fornec')+'" class="btn btn-primary" role="button">Prestador</a> <a href="#/servico/'+object.id+'" class="btn btn-default" role="button">Detalhes</a></p>';
                                dados += '</div>';
                                dados += '</div>';
                                dados += '</div>';
                            }

                         $('#listservicos').html(dados);


                    },
                    error: function(error) {
                            alert("Error: " + error.code + " " + error.message);
                    }
                });
                //***********

               // $state.go('grupo.detail', { grupoId: $scope.id });
 
            }
        })
        
        .state('servicosporfornec', {
            url: '/servicos/:fornecID',
            templateUrl: 'servicos.html',
            controller: function($scope, $stateParams, $state) {
                
                $scope.fornecid = $stateParams.fornecID;
                var fornecid = $stateParams.fornecID;
                var ret;
    
                var Servico= Parse.Object.extend("servico");
                var query = new Parse.Query(Servico);
                query.equalTo("fornec", fornecid);
                
                query.find({
                    success: function(results) {

                        var dados = '';
                        for (var i = 0; i < results.length; i++) { 
                              var object = results[i];
                              dados += '<div class="col-sm-6 col-md-4">';
                                dados += '<div class="thumbnail">';
                                dados += '<img src="'+object.get('capa')+'" alt="'+object.get('nome')+'">';
                                dados += '<div class="caption">';
                                dados += '<h3>'+object.get('desc')+'</h3>';
                                dados += '<p>'+object.get('resumo').substring(0, 300) +'...</p>';
                                dados += '<p  class="label label-success">A partir de R$ '+object.get('preco')+'</p>';
                                dados += '<p><a href="#/prest/'+object.get('fornec')+'" class="btn btn-primary" role="button">Prestador</a> <a href="#/servico/'+object.id+'" class="btn btn-default" role="button">Detalhes</a></p>';
                                dados += '</div>';
                                dados += '</div>';
                                dados += '</div>';
                            }

                         $('#listservicos').html(dados);


                    },
                    error: function(error) {
                            alert("Error: " + error.code + " " + error.message);
                    }
                });
                //***********

               // $state.go('grupo.detail', { grupoId: $scope.id });
 
            }
        })
        
        .state('servico', {
            url: '/servico/:servicoID',
            templateUrl: 'servico.html',
            controller: function($scope, $stateParams, $state) {
            
                $scope.servicoid = $stateParams.servicoID;
                var servicoid = $stateParams.servicoID;
                var ret;
    
                var Servico= Parse.Object.extend("servico");
                var query = new Parse.Query(Servico);
                query.equalTo("objectId", servicoid);
                
                query.find({
                    success: function(results) {

                        var ret = '';
                        ret = '<h3>'+results[0].attributes.desc+'</h3>';
                        ret += '<p>'+results[0].attributes.resumo+'</p><br>';
                        ret += '<p>'+results[0].attributes.preco+'</p><br>';

                        $('#dadosservico').html(ret);

                    },
                    error: function(error) {
                            alert("Error: " + error.code + " " + error.message);
                    }
                });
                //***********

               // $state.go('grupo.detail', { grupoId: $scope.id });
 
            }
        })
        
        .state('feiraimages', {
            url: '/feira/:feiraID/images',
            templateUrl: 'feira-images.html',
            controller: function($scope, $stateParams, $state, $upload) {
                
                $scope.ofertaid = $stateParams.ofertaID;
                console.log($scope.ofertaid);
                console.log($scope.files==undefined);
                console.log($scope.ofertanome);
                
                $scope.$watch('files', function() {
                
                
                  var dados = ''; 
                	
                  for (var i = 0; i < $scope.files.length; i++) {
                        var file = $scope.files[i];
                        
                        console.log(file);
                        
                        
                        
                        var parseFile = new Parse.File(file.name, file);
  				
  				var Image = Parse.Object.extend("ofertaimages");
				        var image = new Image();
				
				        image.set("oferta", $scope.ofertaid);
				        image.set("image", parseFile);
				
				        image.save(null, {
			  		     success: function(oferta) {
			  		
			  			    console.log('image salva');
			  			    console.log(image);
			  			    
			  			    dados = dados + '<li><img src="'+image.attributes.image._url+'" class="img-thumbnail" alt="Responsive image"></li>';
                        			    $('#images').html(dados);
                             //$state.go('ofertaDet', { ofertaID: oferta.id });
			 	 	     },
			  		     error: function(grupo, error) {
					       // Execute any logic that should take place if the save fails.
					       // error is a Parse.Error with an error code and message.
					       alert('Failed to create new object, with error code: ' + error.message);
					     }
			     	});
                    }

                });
            }
        })
        
        .state('login', {
            url: '/login',
            templateUrl: 'login.html',
            controller: function($scope, $stateParams, $state) {
            
            	if (Parse.User.current()) {
            		$state.go('home');
            	} 
            }
        })
    
        .state('novoemp', {
            url: '/empreendimento/novo',
            templateUrl: 'empnovo.html',
            controller: function($scope, $stateParams, $state) {
            
            }
        });
        
       
    $locationProvider.html5Mode(false);
        
})

.controller('formEmpController', function($scope, $state, $stateParams) {
    
    		$scope.formData = {};
    
    console.log($scope.formData);
    		
/*    		$scope.processForm = function() {
        	
            var Oferta = Parse.Object.extend("oferta");
			var oferta = new Oferta();
			
			console.log($scope.formData);
			 
			oferta.set("titulo", $scope.formData.nome);
			oferta.set("descricao", $scope.formData.desc);
			oferta.set("preco", parseFloat($scope.formData.preco));
			oferta.set("aberta", true);
			oferta.set("negociando", false);
			oferta.set("aceitatroca", true);
			oferta.set("anunciante", Parse.User.current().id);
			oferta.set("grupo", $scope.grupoid);
			 
			oferta.save(null, {
			  success: function(oferta) {
			     	$scope.ofertanome = $scope.formData.nomej
                  		$state.go('Ofertaimages', { ofertaID: oferta.id });
			  },
			  error: function(grupo, error) {
			    alert('Failed to create new object, with error code: ' + error.message);
			  }
			});
    	   }*/
})

.controller('DropdownCtrl', function ($scope, $log) {

  $scope.status = {
    isopen: false
  };

  $scope.toggled = function(open) {
    $log.log('Dropdown is now: ', open);
  };

  $scope.toggleDropdown = function($event) {
    $event.preventDefault();
    $event.stopPropagation();
    $scope.status.isopen = !$scope.status.isopen;
  };
});